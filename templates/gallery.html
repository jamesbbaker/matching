{% extends "base.html" %} {% block content %}
{% block head %}
<style>
   .card-container {
    display: flex;
    flex-wrap: wrap;
    justify-content: center; 
    min-height: 1200px;
  }

  .flip-card {
    background-color: transparent;
    width: 100%;
    padding: 20px;
    margin-bottom: 20px;
    min-height: 400px;
    max-height: 600px;
  }

  .flip-card-inner {
    position: relative;
    width: 100%;
    text-align: center;
    transition: transform 0.8s;
    transform-style: preserve-3d;
    box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2);
    padding: 10px;
    min-height: 400px;
    max-height: 600px;
  }

  .purple-background{
  }

  .flip-card-front, .flip-card-back {
    position: absolute;
    width: 100%;
    backface-visibility: hidden;
    min-height: 400px;
    max-height: 600px;
    margin-bottom: 20px;
  }

  .flip-card-front {
    padding: 20px;
    margin-bottom: 20px;
  }

  .flip-card-back {
    transform: rotateY(180deg);
    overflow-y: auto;
  }
  
    .citation-btn {
        padding: 1rem;
        border-radius: 5px;
        font-weight:bold;
        width: 100%;
        min-width: 100%;
        margin-bottom: 0.5rem;
        cursor: pointer;
    }
    .flipped {
      transform: rotateY(180deg);
    }
    .popup-container {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        color: black;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        display: none;
        z-index: 1000;
    }
    .popup-content {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background-color: lightgray;
        color: black;
        padding: 20px;
        border-radius: 5px;
        width: 80%;
        max-height: 80%;
        overflow-y: auto;
    }
    .popup-close {
        position: absolute;
        top: 10px;
        right: 10px;
        font-size: 20px;
        cursor: pointer;
    }
  @media (max-width: 768px) {
    .card-container {
        min-height: 5000px;
        max-height: 12000px;
    }
    .flip-card-front, .flip-card-back, .flip-card-inner, .flip-card {
      min-height: 600px;
    max-height: 9000px;
    }

    .citation-btn {
        padding: 1rem;
        border-radius: 5px;
        font-weight: normal;
        font-size:14px;
    }
  }
</style>
{% endblock %}
<h2 class="text-left text-white text-4xl mb-8">Gallery</h2>
<div class="container mx-auto py-8">
    <div class="card-container">
        {% for agent in approved_agents %}
        <div class="flip-card mb-20">
            <div class="flip-card-inner mb-20">
                <div class="flip-card-front bg-gray-700 rounded-lg shadow-lg p-4 mb-20">
                    <h3 class="text-center text-xl mb-2">Title: {{ agent.title }}</h3>
                    <p class="text-sm mb-4">User: {{ agent.author }}</p>
                    <br>
                    <p class="text-sm mb-4">Objective: {{ agent.objective }}</p>
                    <br>
                    <p class="text-sm mb-4">Output: {{ agent.output }}</p>
                    <div class="text-right">
                        <button class="bg-blue-100 hover:bg-blue-300 text-black font-bold py-1 px-2 rounded view-references">View References</button>
                    </div>
                </div>
                <div class="flip-card-back bg-gray-700 rounded-lg shadow-lg p-4  mb-20"">
                    <div class="references">
                  {% for ref in agent.refs %}
                    {% with ref_data=ref.values()|first %}
                      {% with random_color=colors|random %}
                        <button class="citation-btn" data-summary="{{ ref_data.summary|safe }}" data-url="{{ ref_data.url }}" style="background-color: {{ random_color.bg }}; color: {{ random_color.text }};">
                          <h3>{{ ref_data.reference }}</h3>
                        </button>
                      {% endwith %}
                    {% endwith %}
                  {% endfor %}
                    </div>
                    <div class="text-right">
                        <button class="bg-red-100 hover:bg-red-300 text-black font-bold py-1 px-2 rounded close-references">Close</button>
                    </div>
                </div>
            </div>
        </div>
                      
        {% endfor %}
      </div>
    </div>
    <div id="popup-container" class="popup-container text-black text-base" onclick="hidePopup()">
        <div id="popup-content" class="popup-content text-black text-base" onclick="event.stopPropagation()">
            <span class="popup-close">&times;</span>
        </div>
      </div>
    <script>
        const colors = [
            { bg: '#4B0082', text: 'white' },
            { bg: '#6A5ACD', text: 'white' },
            { bg: '#9370DB', text: 'black' },
            { bg: '#B0C4DE', text: 'black' },
            { bg: '#4682B4', text: 'white' },
            { bg: '#6495ED', text: 'black' },
            { bg: '#87CEFA', text: 'black' },
            { bg: '#ADD8E6', text: 'black' },
        ];

        function applyButtonColor(button) {
            const color = colors[Math.floor(Math.random() * colors.length)];
            button.style.backgroundColor = color.bg;
            button.style.color = color.text;
        }

        function createRefButton(refNumber, refData) {
            const button = document.createElement('button');
            button.classList.add('citation-btn');
            button.innerHTML = `<h3>${refData.reference}</h3>`;
            applyButtonColor(button);
            button.onclick = () => showPopup(`<p class='text-base'>${refData.summary}</p><br><a href="${refData.url}" target="_blank">${refData.url}</a>`);
            return button;
        }

        function showPopup(content) {
            const popupContainer = document.getElementById("popup-container");
            const popupContent = document.getElementById("popup-content");
            popupContent.innerHTML = content;
            popupContainer.style.display = "block";
        }

        function hidePopup() {
            const popupContainer = document.getElementById("popup-container");
            popupContainer.style.display = "none";
        }

      document.querySelectorAll(".citation-btn").forEach(button => {
        button.addEventListener("click", (event) => {
          const summary = button.getAttribute("data-summary");
          const url = button.getAttribute("data-url");
          showPopup(`<p class='text-base'>${summary}</p><br><a href="${url}" target="_blank">${url}</a>`);
        });
      });
      
        document.querySelectorAll(".view-references, .close-references").forEach(button => {
          button.addEventListener("click", (event) => {
            event.stopPropagation();
            button.closest(".flip-card").querySelector(".flip-card-inner").classList.toggle("flipped");
          });
        });
    </script>

{% endblock %}